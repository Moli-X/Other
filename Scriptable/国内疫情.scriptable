{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "blue",
    "glyph" : "feather-alt"
  },
  "name" : "ã€ŒDJGã€å›½å†…ç–«æƒ…",
  "script" : "\/*\n\/\/ æŠ–éŸ³æœç´¢ï¼šå¤§èˆ…å“¥ç§‘æŠ€\n\/\/ å¾®ä¿¡æœç´¢å°ç¨‹åºã€Œå¤§èˆ…å“¥ç§‘æŠ€ã€\n\/\/ è·å–æ›´å¤šç²¾ç¾å®ç”¨ iOS æ¡Œé¢ç»„ä»¶ï¼\n\/\/ æ›´å¤šå…è´¹ç²¾é€‰å¿«æ·æŒ‡ä»¤ã€å£çº¸ï¼Œç­‰ä½ ï¼\n\/\/ ***************************\n\/\/ ç¯å¢ƒæ¡†æ¶   ï¼š@ DmYY\n\/\/ script\t ï¼š@ DJG\n*\/\n\nFILE = FileManager.local()\nFILEPATH = FILE.joinPath(FILE.libraryDirectory(), \"\/DJG.js\")\nconst { DJG, Runing } = importModule(FILEPATH);\n\n\/\/ @ç»„ä»¶ä»£ç å¼€å§‹\nclass Widget extends DJG {\n  constructor(arg) {\n    super(arg);\n    this.name = 'å›½å†…ç–«æƒ…';\n    this.widget_ID = \"DJG-101\";\n    this.version = \"V3.5\";\n    this.coviddataUrl = \"https:\/\/api.inews.qq.com\/newsqa\/v1\/query\/inner\/publish\/modules\/list?modules=statisGradeCityDetail,diseaseh5Shelf\";\n    this.covidurl = 'https:\/\/voice.baidu.com\/act\/newpneumonia\/newpneumonia\/?from=osari_aladin_top1#tab0';\n    this.citys = [\n      'æ±Ÿè‹','äº‘å—','å¹¿ä¸œ','æ¹–å—','æ¹–åŒ—','ä¸Šæµ·','å››å·','å¤©æ´¥','æ²³å—','å±±ä¸œ','ç¦å»º','é™•è¥¿','åŒ—äº¬','é»‘é¾™æ±Ÿ','æµ™æ±Ÿ',\n      'æ²³åŒ—','å®‰å¾½','æ–°ç–†','æ±Ÿè¥¿','é‡åº†','å‰æ—','è¾½å®','å†…è’™å¤','å¹¿è¥¿','å±±è¥¿','ç”˜è‚ƒ','æµ·å—','è´µå·','å®å¤','é’æµ·'];\n\tthis.cityCode = [\n      'jiangsu','yn','gd','hn','hb','sh','cd','tj','henan','sd','fj','xian','bj','helongjiang','zj','hebei','ah',\n      'xinjiang','jiangxi','cq','jilin','ln','neimenggu','guangxi','shanxi','gansu','hainan','guizhou','ningxia','qinghai','xizang'];\n    this.Run();\n  }\n  \n  \/**\n   * æ¸²æŸ“å‡½æ•°ï¼Œå‡½æ•°åå›ºå®š\n   * å¯ä»¥æ ¹æ® this.widgetFamily æ¥åˆ¤æ–­å°ç»„ä»¶å°ºå¯¸ï¼Œä»¥è¿”å›ä¸åŒå¤§å°çš„å†…å®¹\n   *\/\n  async render () {\n    let widget = this.getWidget();\n    await this.getWidgetBackgroundImage(widget);\n    try{\n      switch (this.widgetFamily) {\n        case 'small':\n        \tawait this.renderSmall(widget);\n        \tbreak;\n        case 'medium':\n        \tawait this.renderMedium(widget);\n        \tbreak;\n        default:\n        \tawait this.renderMedium(widget, true);\n        \tbreak;\n      }\n    }catch(e){\n      this.ERROR.push({error:e.toString()});\n    }\n    return widget;\n  }\n  \n  formatr(str) {\n    return (str<0 ? \"è¾ƒæ˜¨æ—¥\"+str : \"è¾ƒæ˜¨æ—¥+\"+str)\n  }\n  \n  \/\/ å°ç»„ä»¶\n  async renderSmall(widget){\n    widget.setPadding(10, 15, 10, 15);\n    let coviddata = await this.httpGet(this.coviddataUrl);\n    coviddata = coviddata.data.diseaseh5Shelf.areaTree[0].children.splice(0, 3);\n    this.addText(widget, `ğŸ¦    å›½å†…ç–«æƒ…`, 12, {font:'bold', opaciry:0.8});\n    widget.addSpacer();\n    for(let i = 0; i < coviddata.length; i++){\n      let confirm = coviddata[i].today.confirm;\n      if(confirm > 0) confirm = '+' + confirm;\n      const covidArr = [coviddata[i].name, coviddata[i].total.confirm, confirm];\n      this.addText(widget, `${covidArr[0]}  ${covidArr[1]}`, 13);\n      this.addText(widget, `æ–°å¢ï¼š${covidArr[2]}`, 10, {font:'bold', opaciry:0.8, color:'FF8247'});\n      widget.addSpacer(3)\n    }\n    widget.addSpacer(5);\n    this.addText(widget, coviddata[0].total.mtime, 9, {opaciry:0.8, align:'center'})\n  }\n  \n  \/\/ ä¸­ç»„ä»¶\n  async renderMedium(w, bool=false){\n    let coviddata = await this.httpGet(this.coviddataUrl)\n    coviddata = coviddata.data.diseaseh5Shelf;\n    let chinaTotal = coviddata.chinaTotal;\n    let chinaAdd = coviddata.chinaAdd;\n    w.addSpacer(5)\n    this.addText(w, 'ğŸ¦  '+this.name, 12, {font:'bold', opacity:0.8});\n    w.addSpacer(8)\n    \n    let upStack = w.addStack()\n    upStack.layoutHorizontally()\n    upStack.url = this.covidurl;\n    const titles = [\"æœ¬åœŸç°æœ‰ç¡®è¯Š\",\"ç°æœ‰ç¡®è¯Š\",\"ç´¯è®¡ç¡®è¯Š\"]\n    const newsdatas = [`${chinaTotal.localConfirmH5}`,`${chinaTotal.nowConfirm}`,`${chinaTotal.confirm}`]\n    const colors = ['FF4500', 'FF00FF', 'FFA500']\n    const newAdd = [chinaAdd.localConfirmH5,chinaAdd.nowConfirm,chinaAdd.confirm]\n    \n    const titles2 = [\"æ— ç—‡çŠ¶æ„ŸæŸ“è€…\",\"å¢ƒå¤–è¾“å…¥\",\"ç´¯è®¡æ­»äº¡\"]\n    const cityNewsdata = [`${chinaTotal.noInfect}`,`${chinaTotal.importedCase}`,`${chinaTotal.dead}`]\n    const cityCor = ['FF0000', '00CD00', '666666'];\n    const cityNewAdd = [chinaAdd.noInfect,chinaAdd.importedCase,chinaAdd.dead]\n    \n    for(let i = 0; i < 3; i++){\n      let stack = upStack.addStack()\n      stack.layoutVertically()\n      \n      this.addText(stack, titles[i], 14)\n      stack.addSpacer(1)\n      this.addText(stack, this.numFormatr(newsdatas[i]), 14, {font:'bold', color:colors[i]})\n      stack.addSpacer(1)\n      this.addText(stack, this.formatr(newAdd[i]), 9, {font:'bold', opacity:0.8})\n      i != 2 ? upStack.addSpacer(): \"\"\n      stack.addSpacer(8)\n      this.addText(stack, titles2[i], 14)\n      stack.addSpacer(1)\n      this.addText(stack, this.numFormatr(cityNewsdata[i]), 14, {font:'bold', color:cityCor[i]})\n      stack.addSpacer(1)\n      this.addText(stack, this.formatr(cityNewAdd[i]), 9, {font:'bold', opacity:0.8})\n      i != 2 ? upStack.addSpacer(): \"\";\n    }\n    if(bool) {\n      w.addSpacer(8)\n      const body = w.addStack()\n      body.layoutVertically()\n      const news = await this.covidNews() || [];\n      if(news.length != 0){\n        this.addText(body, `${this.settings.city||'å›½å†…'}ç–«æƒ…æœ€æ–°èµ„è®¯`, 14, {font:'light'})\n        body.addSpacer(7)\n        for(let i = 0; i < 7; i++){\n          this.addText(body, `${i+1}. ${news[i].title}`, 13, {font:'light', url:news[i].news_url})\n          if(i !=6) body.addSpacer(6)\n        }\n      }\n    }\n    \n    w.addSpacer(5)\n    this.addText(w, coviddata.lastUpdateTime, 9, {opacity:0.8,align:'right'})\n  }\n\n  \/\/ ç–«æƒ…èµ„è®¯\n  async covidNews(){\n    if(!this.settings.city){\n      let date = new Date();\n      let covidNewsURL = \"https:\/\/channel.chinanews.com\/cns\/s\/5013.shtml?pager=0&_=\"+Math.floor(date.getTime());\n      let data = (await this.httpGet2(covidNewsURL, false)).slice(17,-29);\n      return JSON.parse(data).docs\n    } else {\n      if(this.citys.indexOf(this.settings.city) != -1){\n      \tlet cityID = this.cityCode[this.citys.indexOf(this.settings.city)];\n      \tif(cityID){\n          let covidNewsURL = `https:\/\/api.dreamreader.qq.com\/news\/v1\/province\/news\/list?province_code=${cityID}&page_size=10`;\n          let covidNews = await this.httpGet(covidNewsURL);\n          return covidNews.data.items\n        }\n      }else {logError(\"Errorï¼šç–«æƒ…èµ„è®¯åœ°åŒºè®¾ç½®é”™è¯¯ï¼\")};\n    }\n  }\n  \n  async httpGet2 (url, json = true, useCache = true, options = null, method = 'GET') {\n    let cacheKey = this.hash('channel.chinanews.com');\n    let cacheData = null, error = null;\n    if (this.isUpdate(cacheKey.slice(-8), useCache) || !Keychain.contains(cacheKey)){\n      try {\n        let req = new Request(url)\n        req.method = method\n        if(options){\n          Object.keys(options).forEach((key) => {\n            req[key] = options[key];\n          });\n        }\n        cacheData = await (json ? req.loadJSON() : req.loadString());\n      } catch (e) {\n        error = {url:url, error:e.toString()};\n        this.writeError(error);\n      };\n    }\n    if(cacheData && useCache) {\n      this.saveCacheKey(cacheKey);\n      Keychain.set(cacheKey, json ? JSON.stringify(cacheData) : cacheData)\n    }else if (!cacheData && Keychain.contains(cacheKey)) {\n      let cache = Keychain.get(cacheKey)\n      cacheData = json ? JSON.parse(cache) : cache\n    }else {this.ERROR.push(error);}\n    return cacheData;\n  }\n  \n  \/\/ æ·»åŠ è®¾ç½®ä¿¡æ¯\n  Run() {\n    if (config.runsInApp) {\n      this.registerAction(\"åŸºç¡€è®¾ç½®\", this.setWidgetConfig);\n    }\n    this.registerAction(\"åœ°åŒºè®¾ç½®\", async () => {\n      await this.setCustomAction(\"åœ°åŒºè®¾ç½®\", \"è®¾ç½®åœ°åŒºç–«æƒ…æœ€æ–°èµ„è®¯\\næ­£ç¡®è¾“å…¥çœä»½åœ°åŒº\\nä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿ä¸œ\", {\n        city: \"æ¸¯æ¾³å°åœ°åŒºä¸æ”¯æŒ\",\n      },this.city);\n    }, { name: 'location.circle', color: '#66CD00' });\n  }\n}\n\/\/ @ç»„ä»¶ä»£ç ç»“æŸ\nawait Runing(Widget)",
  "share_sheet_inputs" : [

  ]
}
